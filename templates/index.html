<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCX_handler</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --accent-color: #2B7EF6;
            --dark-text: #2D3748;
        }

        /* 学术风格导航 */
        .navbar {
            border-bottom: 1px solid #E2E8F0;
        }
        .nav-brand {
            font-weight: 600;
            color: var(--dark-text) !important;
        }

        /* 论文上传区 */
        .thesis-upload {
            background: #F8FAFF;
            border: 2px dashed #CBD5E0;
            border-radius: 12px;
            padding: 3rem 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .thesis-upload:hover {
            border-color: var(--accent-color);
            box-shadow: 0 10px 15px -3px rgba(43, 126, 246, 0.1);
        }

        /* 规范按钮 */
        .format-btn {
            background: var(--accent-color);
            color: white !important;
            padding: 12px 36px;
            border-radius: 8px;
            font-weight: 500;
            transition: transform 0.2s;
        }
        .format-btn:hover {
            transform: scale(1.03);
            background: #1B6BED;
        }

        /* 格式要求列表 */
        .format-rules {
            counter-reset: rule-counter;
        }
        .format-rule::before {
            counter-increment: rule-counter;
            content: counter(rule-counter);
            background: var(--accent-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        /* 样式定义 */
       footer {
    background-color: #f8f9fa; /* 背景颜色 */
    padding: 10px 20px; /* 内边距 */
    text-align: right; /* 文本右对齐 */
    font-size: 14px; /* 字体大小 */
    color: #333; /* 字体颜色 */
        }
        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <!-- 导航栏 -->
    <nav class="navbar navbar-expand bg-white">
        <div class="container">
            <a class="navbar-brand nav-brand" href="#">
                <i class="bi bi-file-text me-2"></i>
                DOCX_handler
            </a>
            <div class="d-flex">
                <a href="#" class="btn btn-link text-dark">
                    <i class="bi bi-question-circle"></i>
                    格式标准
                </a>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="container my-5" style="max-width: 800px;">
        <!-- 上传区域 -->
        <div class="thesis-upload text-center mb-5">
            <div class="mb-4">
                <i class="bi bi-file-earmark-word fs-1 text-primary"></i>
                <h2 class="mt-3 mb-2">上传学术论文文档</h2>
                <div class="text-muted">支持.docx和.doc格式</div>
            </div>
            <button class="format-btn" id="uploadTrigger">
                <i class="bi bi-upload me-2"></i>
                选择论文文件
            </button>
            <input type="file" hidden  id="fileInput">
        </div>

<!-- 格式规范选项 -->
        <!-- 处理进度 -->
        <div class="processing-alert alert alert-info" style="display: none;">
            <div class="d-flex align-items-center">
                <div class="spinner-border me-3" role="status"></div>
                <div>
                    <strong>正在规范格式：</strong>
                    <span id="currentTask">初始化处理环境...</span>
                </div>
            </div>
        </div>
<!-- 正文样式设置 -->
        <div class="col-md-12">
            <p class="text-muted small mb-3">格式说明：</p>
            <ul class="list-unstyled text-muted small mb-4">
                <li>1. 标题格式标识必须是手打上去，docx根据回车生成的不能被识别。(标题标识默认只识别1到10)</li>
                <li>2. 引用标识要求文末有前后一样格式的序号</li>
                 </li>         示例：    文本[1]文本[1]，文本。  
                                  文献来源：
                                         [1]*********。(引用标识默认只识别1到30)</li>
            </ul>
        </div>
<div class="style-card mb-4 p-4 bg-white rounded shadow-sm">
    <div class="d-flex align-items-center mb-3">
        <i class="bi bi-text-paragraph fs-5 text-primary me-2"></i>
        <h5 class="mb-0">正文样式</h5>
    </div>
    <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label text-muted small">字体选择</label>
            <div class="custom-select">
                <select class="form-select" name="body_font">
                    <option>黑体</option>
                    <option>仿宋</option>
                    <option>微软雅黑</option>
                    <option>隶书</option>
                    <option>幼圆</option>
                    <option>宋体</option>
                    <option>楷体</option>
                    <option>​​Arial</option>
                    <option>Calibri</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-6">
            <label class="form-label text-muted small">字号设置</label>
            <div class="custom-select">
                <select class="form-select" name="body_size">
                    <option>一号</option>
                    <option>二号</option>
                    <option>三号</option>
                    <option>四号</option>
                    <option>五号</option>
                    <option>六号</option>
                    <option>小一号</option>
                    <option>小二号</option>
                    <option>小三号</option>
                    <option>小四号</option>
                    <option>小五号</option>
                    <option>小六号</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
    </div>
</div>

<!-- 标题样式设置 -->
<!-- 标题样式设置 -->
<div class="style-card mb-4 p-4 bg-white rounded shadow-sm">
    <div class="d-flex align-items-center mb-3">
        <i class="bi bi-type-h1 fs-5 text-warning me-2"></i>
        <h5 class="mb-0">标题样式设置</h5>
    </div>
    <div class="row g-3">
        <div class="col-md-3">
            <label class="form-label text-muted small">一级标题标识</label>
            <div class="custom-select">
                <select class="form-select" name="title1_label">
                    <option>无</option>
                    <option>一、 二、 三、</option>
                    <option>（一） （二） （三）</option>
                    <option>1. 2. 3.</option>
                    <option>（1） （2） （3）</option>
                    <option>1.1 1.2 1.3</option>
                    <option>1.1.1 1.1.2 1.1.3</option>
                    <option>1.1.1.1 1.1.1.2 1.1.1.3</option>
                    <option>I II III</option>
                    <option>A B C</option>
                    <option>a b c</option>
                    <option>(A) (B) (C)</option>
                    <option>(a) (b) (c)</option>
                    <option>1-1 1-2 1-3</option>
                    <option>1-1-1 1-1-2 1-1-3</option>
                    <option>1-1-1-1 1-1-1-2 1-1-1-3</option>
                    <option>1. 2. 3.</option>
                    <option>1、 2、 3、</option>
                    <option>(1) (2) (3)</option>
                    <option>（1） （2） （3）</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">一级标题字体</label>
            <div class="custom-select">
                <select class="form-select" name="title1_font">
                    <option>黑体</option>
                    <option>仿宋</option>
                    <option>微软雅黑</option>
                    <option>隶书</option>
                    <option>幼圆</option>
                    <option>宋体</option>
                    <option>楷体</option>
                    <option>​​Arial</option>
                    <option>Calibri</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">一级标题字号</label>
            <div class="custom-select">
                <select class="form-select" name="title1_size">
                    <option>一号</option>
                    <option>二号</option>
                    <option>三号</option>
                    <option>四号</option>
                    <option>五号</option>
                    <option>六号</option>
                    <option>小一号</option>
                    <option>小二号</option>
                    <option>小三号</option>
                    <option>小四号</option>
                    <option>小五号</option>
                    <option>小六号</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">一级标题是否加粗</label>
            <div class="custom-select">
                <select class="form-select" name="title1_bold">
                    <option>否</option>
                    <option>是</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-md-3">
            <label class="form-label text-muted small">二级标题标识</label>
            <div class="custom-select">
                <select class="form-select" name="title2_label">
                    <option>无</option>
                    <option>一、 二、 三、</option>
                    <option>（一） （二） （三）</option>
                    <option>1. 2. 3.</option>
                    <option>（1） （2） （3）</option>
                    <option>1.1 1.2 1.3</option>
                    <option>1.1.1 1.1.2 1.1.3</option>
                    <option>1.1.1.1 1.1.1.2 1.1.1.3</option>
                    <option>I II III</option>
                    <option>A B C</option>
                    <option>a b c</option>
                    <option>(A) (B) (C)</option>
                    <option>(a) (b) (c)</option>
                    <option>1-1 1-2 1-3</option>
                    <option>1-1-1 1-1-2 1-1-3</option>
                    <option>1-1-1-1 1-1-1-2 1-1-1-3</option>
                    <option>1. 2. 3.</option>
                    <option>1、 2、 3、</option>
                    <option>(1) (2) (3)</option>
                    <option>（1） （2） （3）</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">二级标题字体</label>
            <div class="custom-select">
                <select class="form-select" name="title2_font">
                    <option>黑体</option>
                    <option>仿宋</option>
                    <option>微软雅黑</option>
                    <option>隶书</option>
                    <option>幼圆</option>
                    <option>宋体</option>
                    <option>楷体</option>
                    <option>​​Arial</option>
                    <option>Calibri</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">二级标题字号</label>
            <div class="custom-select">
                <select class="form-select" name="title2_size">
                    <option>一号</option>
                    <option>二号</option>
                    <option>三号</option>
                    <option>四号</option>
                    <option>五号</option>
                    <option>六号</option>
                    <option>小一号</option>
                    <option>小二号</option>
                    <option>小三号</option>
                    <option>小四号</option>
                    <option>小五号</option>
                    <option>小六号</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">二级标题是否加粗</label>
            <div class="custom-select">
                <select class="form-select" name="title2_bold">
                    <option>否</option>
                    <option>是</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-md-3">
            <label class="form-label text-muted small">三级标题标识</label>
            <div class="custom-select">
                <select class="form-select" name="title3_label">
                    <option>无</option>
                    <option>一、 二、 三、</option>
                    <option>（一） （二） （三）</option>
                    <option>1. 2. 3.</option>
                    <option>（1） （2） （3）</option>
                    <option>1.1 1.2 1.3</option>
                    <option>1.1.1 1.1.2 1.1.3</option>
                    <option>1.1.1.1 1.1.1.2 1.1.1.3</option>
                    <option>I II III</option>
                    <option>A B C</option>
                    <option>a b c</option>
                    <option>(A) (B) (C)</option>
                    <option>(a) (b) (c)</option>
                    <option>1-1 1-2 1-3</option>
                    <option>1-1-1 1-1-2 1-1-3</option>
                    <option>1-1-1-1 1-1-1-2 1-1-1-3</option>
                    <option>1. 2. 3.</option>
                    <option>1、 2、 3、</option>
                    <option>(1) (2) (3)</option>
                    <option>（1） （2） （3）</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">三级标题字体</label>
            <div class="custom-select">
                <select class="form-select" name="title3_font">
                    <option>黑体</option>
                    <option>仿宋</option>
                    <option>微软雅黑</option>
                    <option>隶书</option>
                    <option>幼圆</option>
                    <option>宋体</option>
                    <option>楷体</option>
                    <option>​​Arial</option>
                    <option>Calibri</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">三级标题字号</label>
            <div class="custom-select">
                <select class="form-select" name="title3_size">
                    <option>一号</option>
                    <option>二号</option>
                    <option>三号</option>
                    <option>四号</option>
                    <option>五号</option>
                    <option>六号</option>
                    <option>小一号</option>
                    <option>小二号</option>
                    <option>小三号</option>
                    <option>小四号</option>
                    <option>小五号</option>
                    <option>小六号</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">三级标题是否加粗</label>
            <div class="custom-select">
                <select class="form-select" name="title3_bold">
                    <option>否</option>
                    <option>是</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-md-3">
            <label class="form-label text-muted small">四级标题标识</label>
            <div class="custom-select">
                <select class="form-select" name="title4_label">
                    <option>无</option>
                    <option>一、 二、 三、</option>
                    <option>（一） （二） （三）</option>
                    <option>1. 2. 3.</option>
                    <option>（1） （2） （3）</option>
                    <option>1.1 1.2 1.3</option>
                    <option>1.1.1 1.1.2 1.1.3</option>
                    <option>1.1.1.1 1.1.1.2 1.1.1.3</option>
                    <option>I II III</option>
                    <option>A B C</option>
                    <option>a b c</option>
                    <option>(A) (B) (C)</option>
                    <option>(a) (b) (c)</option>
                    <option>1-1 1-2 1-3</option>
                    <option>1-1-1 1-1-2 1-1-3</option>
                    <option>1-1-1-1 1-1-1-2 1-1-1-3</option>
                    <option>1. 2. 3.</option>
                    <option>1、 2、 3、</option>
                    <option>(1) (2) (3)</option>
                    <option>（1） （2） （3）</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">四级标题字体</label>
            <div class="custom-select">
                <select class="form-select" name="title4_font">
                    <option>黑体</option>
                    <option>仿宋</option>
                    <option>微软雅黑</option>
                    <option>隶书</option>
                    <option>幼圆</option>
                    <option>宋体</option>
                    <option>楷体</option>
                    <option>​​Arial</option>
                    <option>Calibri</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">四级标题字号</label>
            <div class="custom-select">
                <select class="form-select" name="title4_size">
                    <option>一号</option>
                    <option>二号</option>
                    <option>三号</option>
                    <option>四号</option>
                    <option>五号</option>
                    <option>六号</option>
                    <option>小一号</option>
                    <option>小二号</option>
                    <option>小三号</option>
                    <option>小四号</option>
                    <option>小五号</option>
                    <option>小六号</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
        <div class="col-md-3">
            <label class="form-label text-muted small">四级标题是否加粗</label>
            <div class="custom-select">
                <select class="form-select" name="title4_bold">
                    <option>否</option>
                    <option>是</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
    </div>
</div>
<!-- 论文引用标识设置 -->
<div class="style-card mb-4 p-4 bg-white rounded shadow-sm">
    <div class="d-flex align-items-center mb-3">
        <i class="bi bi-journal-text fs-5 text-info me-2"></i>
        <h5 class="mb-0">论文引用标识</h5>
    </div>
    <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label text-muted small">引用标识样式</label>
            <div class="custom-select">
                <select class="form-select" name="citation_style">
                    <option>无</option>
                    <option>[1] [2] [3]</option>
                    <option>【1】 【2】 【3】</option>
                </select>
                <i class="bi bi-chevron-down"></i>
            </div>
        </div>
    </div>
</div>

<!-- 评论区容器 -->
<div class="comment-section">
    <style>
        /* 限定样式作用域 */
        .comment-section {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        /* 评论框样式 */
        .comment-section .comment-box {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* 标题 */
        .comment-section .comment-title {
            font-size: 1.8rem;
            color: #1a1a1a;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #007bff;
        }

        /* 表单样式 */
        .comment-section .commentform {
            margin-bottom: 2rem;
        }

        .comment-section .form-group {
            margin-bottom: 1.2rem;
        }

        /* 输入框 */
        .comment-section .form-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .comment-section .form-input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }

        .comment-section textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }

        /* 提交按钮 */
        .comment-section .submit-btn {
            background: #007bff;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comment-section .submit-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        /* 评论列表 */
        .comment-section .comments-list {
            margin-top: 2rem;
        }

        /* 单条评论 */
        .comment-section .comment-card {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease;
        }

        .comment-section .comment-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .comment-section .comment-author {
            font-weight: 600;
            color: #1a1a1a;
            margin-right: 0.8rem;
        }

        .comment-section .comment-time {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .comment-section .comment-content {
            color: #444;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* 空状态提示 */
        .comment-section .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 2rem;
        }

        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 响应式适配 */
        @media (max-width: 768px) {
            .comment-section .comment-box {
                padding: 1.5rem;
            }
            
            .comment-section .comment-title {
                font-size: 1.5rem;
            }
            
            .comment-section .submit-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>


    </main>
    <script>
        // 文件处理逻辑修改为真实请求
      document.addEventListener('DOMContentLoaded', function() {
          const uploadTrigger = document.getElementById('uploadTrigger');
          const fileInput = document.getElementById('fileInput');

          uploadTrigger.addEventListener('click', function() {
                fileInput.click(); // 触发文件输入框的点击事件
            });

          fileInput.addEventListener('change', async function(e) {
            console.log('yijinru:');
            const file = this.files[0];
            if (!file) return;
                // 文件选择后的逻辑
            console.log('文件已选择:', file.name);
            
            const alertBox = document.querySelector('.processing-alert');
            const statusText = document.getElementById('currentTask');
            alertBox.style.display = 'block';
            statusText.textContent = '正在上传并处理文件...';

            // 创建表单数据对象
            const formData = new FormData();
            formData.append('document', file);
            formData.append('_t', Date.now()); // 时间戳防止缓存
            // 收集格式参数
            const formatParams = {
    body_font: document.querySelector('[name="body_font"]').value,
    body_size: document.querySelector('[name="body_size"]').value,
    title1_label: document.querySelector('[name="title1_label"]').value,
    title1_font: document.querySelector('[name="title1_font"]').value,
    title1_size: document.querySelector('[name="title1_size"]').value,
    title1_bold: document.querySelector('[name="title1_bold"]').value, 
    title2_label: document.querySelector('[name="title2_label"]').value,
    title2_font: document.querySelector('[name="title2_font"]').value,
    title2_size: document.querySelector('[name="title2_size"]').value,
    title2_bold: document.querySelector('[name="title2_bold"]').value ,
    title3_label: document.querySelector('[name="title3_label"]').value,
    title3_font: document.querySelector('[name="title3_font"]').value,
    title3_size: document.querySelector('[name="title3_size"]').value,
    title3_bold: document.querySelector('[name="title3_bold"]').value,
    title4_label: document.querySelector('[name="title4_label"]').value,
    title4_font: document.querySelector('[name="title4_font"]').value,
    title4_size: document.querySelector('[name="title4_size"]').value,
    title4_bold: document.querySelector('[name="title4_bold"]').value,
    citation_style: document.querySelector('[name="citation_style"]').value
            };
            formData.append('params', JSON.stringify(formatParams));

            try {
                 const response = await fetch('http://127.0.0.1:5000/process2', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('处理失败');
                
                // 处理返回的文档
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                
                // 创建下载链接
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = `formatted_${file.name}`;
                document.body.appendChild(link);
                link.click();
                
                // 清理资源
                window.URL.revokeObjectURL(downloadUrl);
                document.body.removeChild(link);
            } catch (error) {
                console.error('处理错误:', error);
                alert('服务器繁忙: ' + error.message);
            } finally {
                fileInput.value = '';
                alertBox.style.display = 'none';

            }
        });
    });
    </script>
   
</body>
</html>